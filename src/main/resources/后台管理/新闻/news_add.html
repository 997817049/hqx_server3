<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <title>新增新闻</title>
    <link rel="stylesheet" type="text/css" href="../public/layui/css/layui.css">
    <link href="../public/css/common.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../public/css/nav.css">
    <link rel="stylesheet" type="text/css" href="../public/css/iconfont.css">
    <script src="../public/js/jquery-3.2.1.min.js"></script>
    <script src="../public/layui/layui.js"></script>
    <script src="../public/js/alert.js"></script>
    <script src="../public/js/echarts.min.js"></script>
    <script type="text/javascript" src="../wangEditor.js"></script>
</head>
<body>
<!-- 头部导航 -->
<div class="jzy_w_max jzy_h_50 br_12">
    <!-- LOGO -->
    <div class="jzy_w_50 jzy_h_50 br_12 br_11_hove lt logo">
        <a href=""><img src="../public/images/aliyun.png"></a>
    </div>
    <!--菜单1-->
    <div class="jzy_w_90 jzy_h_50 br_12 br_11_hove lt top-txt">
        <a class="cr_h_0 fs_14" href="">管理控制台</a>
    </div>

    <!--头像-->
    <div class="jzy_w_50 jzy_h_50 br_12 br_11_hove rt top-txt logo">
        <img class="jzy_boy_18" src="../public/images/touxiang.jpg" width="36" height="36">
        <!-- 头像下拉菜单 -->
        <div class="jzy_w_270 jzy_h_408 br_h_0 top_nav">
            <!--头像跟用户名-->
            <div class="jzy_w_max jzy_h_50 lt" style="margin-top: 15px"><img class="jzy_boy_18"
                                                                             src="../public/images/touxiang.jpg"
                                                                             width="36" height="36"></div>
            <div class="jzy_w_max jzy_h_30 lt" style="line-height: 30px; border-bottom: 1px solid #e2e2e2">
                1731223728@qq.com
            </div>
            <!--用户公共操作权限-->
            <div class="jzy_w_250 jzy_h_250 lt" style="padding: 10px">
                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/jbzl.png"></p>基本资料</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/smrz.png"></p>实名认证</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/aqsz.png"></p>安全设置</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/fxgk.png"></p>风险管控</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/fwkz.png"></p>访问控制</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/api.png"></p>API接口</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/hyqy.png"></p>会员权益</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/hyjf.png"></p>会员积分</a>
                </div>

                <div class="jzy_w_80 jzy_h_80 lt br_h_2_hove">
                    <a><p class="jzy_h_30"><img src="../public/images/icon/wjgl.png"></p>文件管理</a>
                </div>
            </div>
            <!--退出登录-->
            <div class="jzy_w_max jzy_h_42 lt br_h_9" style="background: #f5f5f6; line-height: 45px"><a
                    href="../login.html">退出管理控制台</a></div>
        </div>
    </div>

    <!--菜单2-->
    <div class="jzy_w_90 jzy_h_50 br_12 br_11_hove rt top-txt">
        <a class="cr_h_0 fs_14">语言选择</a>
        <!-- 头像下拉菜单 -->
        <div class="jzy_w_90 br_h_0 top_nav nav2">
            <p class="p"><a href="">简体中文</a></p>
            <p class="p"><a href="">English</a></p>
        </div>
    </div>

    <!--菜单3-->
    <div class="jzy_w_90 jzy_h_50 br_12 br_11_hove rt top-txt">
        <a class="cr_h_0 fs_14">权限设置</a>
        <!-- 头像下拉菜单 -->
        <div class="jzy_w_90 br_h_0 top_nav nav2">
            <p class="p"><a href="">新建权限</a></p>
            <p class="p"><a href="">角色列表</a></p>
            <p class="p"><a href="">部门管理</a></p>
        </div>
    </div>

</div>

<!--左侧主导航-->
<div class="jzy_w_180 lt main_height main_left nav" style="background: #333744">

    <div class="nav-top">
        <div id="mini" style="background: #4a5064; text-align: center"><img src="../public/images/icon/suofang.png"
                                                                            width="20"></div>
    </div>
    <ul>
        <li class="nav-item">
            <a href="javascript:;"><i class="my-icon nav-icon icon_1"></i><span>新闻模块</span><i
                    class="my-icon nav-more"></i></a>
            <ul>
                <li><a href="adm_news.html"><span>新闻</span></a></li>
                <li><a href="adm_character.html"><span>人物</span></a></li>
                <li><a href="adm_military.html"><span>军事</span></a></li>
                <li><a href="adm_history.html"><span>史实</span></a></li>
            </ul>
        </li>

        <li class="nav-item">
            <a href="javascript:;"><i class="my-icon nav-icon icon_1"></i><span>权限设置</span><i
                    class="my-icon nav-more"></i></a>
            <ul>
                <li><a href="menu_list.html"><span>权限菜单</span></a></li>
                <li><a href="manager_list.html"><span>管理员</span></a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="javascript:;"><i class="my-icon nav-icon icon_1"></i><span>系统管理</span><i
                    class="my-icon nav-more"></i></a>
            <ul>
                <li><a href="javascript:;"><span>维护公告</span></a></li>
                <li><a href="javascript:;"><span>版本管理</span></a></li>
                <li><a href="javascript:;"><span>日志编码</span></a></li>
                <li><a href="javascript:;"><span>数据库</span></a></li>
                <li><a href="javascript:;"><span>服务器</span></a></li>
                <li><a href="javascript:;"><span>敏感词设置</span></a></li>
                <li><a href="javascript:;"><span>IP黑名单</span></a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="javascript:;"><i class="my-icon nav-icon icon_1"></i><span>日志管理</span><i
                    class="my-icon nav-more"></i></a>
            <ul>
                <li><a href="javascript:;"><span>管理员登录日志</span></a></li>
                <li><a href="javascript:;"><span>会员登录日志</span></a></li>
                <li><a href="javascript:;"><span>后端操作日志</span></a></li>
                <li><a href="javascript:;"><span>前端操作日志</span></a></li>
            </ul>
        </li>
    </ul>
</div>
<!--左侧次导航-->
<div class="jzy_w_180 lt main_height main_nav" style="background: #D9DEE4">
    <div class="jzy_w_150 jzy_h_70 fs_13 lt" style="font-weight: bold; line-height: 70px;padding-left: 30px">新闻</div>
    <div class="jzy_w_180 fs_13 lt main_height2" style="background: #EAEDF1;">
        <div class="jzy_w_130 jzy_h_40 fs_12 lt" style="line-height: 40px;padding-left: 50px"><a href="news_add.html">新增新闻</a>
        </div>
        <div class="jzy_w_130 jzy_h_40 fs_12 lt" style="line-height: 40px;padding-left: 50px"><a href="adm_news.html">新闻列表</a>
        </div>
    </div>
</div>

<!--主内容框架-->
<div class="main_height main_index lt" style="background: #f2f4f8;">
    <div class="layui-btn-group demoTable jzy_w_max br_h_0 tabTop">
        <span>新增新闻</span>
    </div>
    <!-- <div class="tree_left" id="demo2"></div> -->
    <div class="tree_left" style="width: 100%">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>新增新闻</legend>
        </fieldset>
        <div class="layui-form" style="width: 90%">
            <!-- <div class="layui-form-item">
                <label class="layui-form-label">上级所属</label>
                <div class="layui-input-block" style="line-height: 36px; font-size: 15px">
                    广东省
                </div>
            </div> -->

            <div class="layui-form-item">
                <label class="layui-form-label">标题</label>
                <div class="layui-input-block">
                    <input id="title" type="text" name="title" placeholder="请输入标题" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">来源</label>
                <div class="layui-input-block">
                    <input id="type" type="text" name="title" placeholder="例如：人民网-国际频道" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">头条</label>
                <div class="layui-input-block">
                    <input id="is_top" type="checkbox" name="close" lay-filter="switch_top" lay-skin="switch"
                           lay-text="ON|OFF">
                </div>
            </div>
            <div class="layui-form-item" id="start_write_div">
                <div class="layui-input-block">
                    <!-- <button id="start_write" class="layui-btn layui-btn-sm layui-btn-normal">确认</button> -->
                    <button id="start_write" class="layui-btn layui-btn-normal">确认</button>
                </div>
            </div>

            <div id="write" style="font-size: 15px; margin-left: 5%; display: none;">
                <div id="editor" style="margin-bottom: 10px;">
                </div>

                <!-- <div class="layui-form-item"> -->
                <!-- <div class="layui-input-block"> -->
                <button id="go_write" class="layui-btn layui-btn-normal">提交</button>
                <!-- </div> -->
                <!-- </div> -->
            </div>
        </div>

    </div>
</div>


<script type="text/javascript" src="../public/js/nav.js"></script>
<script>
    layui.use(['form', 'table', 'tree'], function () {
        var table = layui.table
            , form = layui.form
            , laydate = layui.laydate;

        // 左侧菜单
        // layui.tree({
        //     elem: '#demo2'
        //     ,nodes: [{ //节点
        //         name: '广东省'
        //         ,children: [{
        //         name: '子节点11'
        //         },{
        //         name: '子节点12'
        //         }]
        //     },{
        //         name: '湖南省'
        //         ,children: [{
        //         name: '子节点21'
        //         ,children: [{
        //             name: '子节点211'
        //         }]
        //         }]
        //     }]
        //     ,click: function(node){
        //         console.log(node) //node即为当前点击的节点数据
        //     }
        // });
    });
    var is_top = 0;
    layui.use(['form'], function () {
        var form = layui.form;
        form.on('switch(switch_top)', function (data) {
            //开关是否开启，true或者false
            var checked = data.elem.checked;
            if (checked) {
                is_top = 2;
            } else {
                is_top = 0;
            }
            console.log(checked + "  " + is_top);
        });
    });
</script>
<script>
    $(function () {
        var E = window.wangEditor;
        var editor = new E('#editor'); // 两个参数也可以传入 elem 对象，class 选择器
        //开启debug模式
        editor.customConfig.debug = true;
        // 关闭粘贴内容中的样式
        editor.customConfig.pasteFilterStyle = false;
        // 忽略粘贴内容中的图片
        editor.customConfig.pasteIgnoreImg = true;
        // 使用 base64 保存图片
        //editor.customConfig.uploadImgShowBase64 = true

        // 上传图片到服务器
        editor.customConfig.uploadFileName = 'myFile'; //设置文件上传的参数名称
        // editor.customConfig.uploadImgServer = " http://localhost:8081/hqx_update/image?id=6"; //设置上传文件的服务器路径
        editor.customConfig.uploadImgServer = "http://127.0.0.1:8081/hqx/resource/image?part=基地"; //设置上传文件的服务器路径
        editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024; // 将图片大小限制为 3M

        //自定义上传图片事件
        editor.customConfig.uploadImgHooks = {
            before: function (xhr, editor, files) {

            },
            success: function (xhr, editor, result) {
                console.log("上传成功");
            },
            fail: function (xhr, editor, result) {
                console.log("上传失败,原因是" + result);
            },
            error: function (xhr, editor) {
                console.log("上传出错");
            },
            timeout: function (xhr, editor) {
                console.log("上传超时");
            },

            // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
            // （但是，服务器端返回的必须是一个 JSON 格式字符串！！！否则会报错）
            customInsert: function (insertImg, result, editor) {
                // 图片上传并返回结果，自定义插入图片的事件（而不是编辑器自动插入图片！！！）
                // insertImg 是插入图片的函数，editor 是编辑器对象，result 是服务器端返回的结果

                // 举例：假如上传图片成功后，服务器端返回的是 {url:'....'} 这种格式，即可这样插入图片：
                var url = result.url;
                insertImg(url);

                // result 必须是一个 JSON 格式字符串！！！否则报错
            }
        };

        editor.create();

        // $("#editorSetBtn").click(function(){
        //     //这是设置编辑器内容
        //     editor.txt.html("dsafdfadsfdafdsfds");
        // })
        $("#go_write").click(function () {
            //获取编辑器的内容，带样式
            //一般使用这个获取数据，通过ajax发送给服务端　，然后服务端以Ｓtring接收，保存到数据库．
            var html = editor.txt.html();
            //处理视频
            //deal_html(html);

            alert(editor.txt.html());
            $.ajax({
                url: "http://114.116.118.232:8081/hqx_update/html",
                type: "POST",
                data: {
                    html: editor.txt.html(),
                    part: 'news',
                    id: 99
                },
                success: function (htmlUrl) {
                    alert("上传html成功 " + htmlUrl);
                }
            });
        });

        function deal_html(htmlContext) {
            var videos = htmlContext.getElementByTagName("iframe");
            console.log(videos);
        }

        //  $("#editorGetBtn2").click(function(){
        // 　　　 //获取编辑器的内容，不带样式，纯文本
        //      alert(editor.txt.text());
        // })
    });

    document.getElementById("start_write").onclick = function () {
        console.log("开始录入");
        document.getElementById("title").disabled = "true";
        document.getElementById("type").disabled = "true";
        document.getElementById("is_top").disabled = "true";
        document.getElementById("start_write_div").style.display = "none";
        document.getElementById("write").style.display = "block";
        alert(document.getElementById("title").value + "   " + document.getElementById("type").value + "   " + is_top);
    };

    document.getElementById("is_top").onclick = function () {
        console.log("点击top");
        if (is_top == 0) {
            is_top = 2;
        } else {
            is_top = 0;
        }
    };
</script>
</body>
</html>
